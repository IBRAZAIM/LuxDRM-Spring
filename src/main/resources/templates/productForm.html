<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Создание товара</title>
  <link rel="stylesheet" th:href="@{/updateForm.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div class="container">
  <h1>Создание товара</h1>
  <p class="subtitle">Заполните информацию о товаре</p>

  <form th:action="@{/products/create}" th:object="${product}" method="post">
    <input type="hidden" name="categoryId" th:value="${category.id}">
    <!-- Основная информация -->
    <div class="form-section">
      <div class="form-group">
        <label>Название товара</label>
        <input type="text" name="name" placeholder="Название товара" required>
      </div>
      <div class="form-group">
        <label>Цена (₸)</label>
        <label>
          <input type="text" name="price" placeholder="Цена" required>
        </label>
      </div>
      <div class="form-group">
        <label>Описание</label>
        <label>
          <textarea name="description" placeholder="Описание товара"></textarea>
        </label>
      </div>
    </div>

    <!-- Характеристики -->
    <div class="form-section">
      <label>Характеристики</label>
      <div class="options-list">
        <div class="option-row" th:each="option : ${category.optionList}">
          <span class="option-name" th:text="${option.name}"></span>
          <input type="hidden" name="optionsIds" th:value="${option.id}" th:if="${option.id != null}">
          <input type="text" name="values" placeholder="Введите значение" required>
        </div>
      </div>
    </div>

    <div class="form-section">
      <label>Размеры</label>
      <div id="sizes" class="items-list" data-empty-text="Пока нет размеров. Нажмите + чтобы добавить.">
        <span class="empty-text">Пока нет размеров. Нажмите + чтобы добавить.</span>
      </div>
      <button type="button" class="add-product-btn" onclick="addItem('sizes', 'Size')">
        <i class="fas fa-plus"></i>
      </button>
    </div>

    <!-- Изображения -->
    <div class="form-section">
      <label>Изображения</label>
      <div id="images" class="items-list" data-empty-text="Изображения не добавлены. Пожалуйста добавьте URL-изображения!">
        <span class="empty-text">Изображения не добавлены. Пожалуйста добавьте URL-изображения!</span>
      </div>
      <button type="button" class="add-product-btn" onclick="addItem('images', 'URL изображения')">
        <i class="fas fa-plus"></i>
      </button>
    </div>

    <!-- Submit -->
    <div class="form-actions">
      <button type="submit" class="btn-primary">Создать товар</button>
    </div>
  </form>
</div>
<script>
  function addItem(listId, placeholder) {
    const list = document.getElementById(listId);

    // Убираем текст-подсказку
    const emptyText = list.querySelector('.empty-text');
    if (emptyText) emptyText.remove();

    // Создаем контейнер
    const container = document.createElement('div');
    container.className = 'option-row';
    container.style.display = 'flex';
    container.style.alignItems = 'center';
    container.style.gap = '6px';

    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = placeholder;
    input.name = listId === 'sizes' ? 'sizes[]' : 'imageUrls[]';

    // Для изображений добавляем превью перед input
    if (listId === 'images') {
      const preview = document.createElement('img');
      preview.style.display = 'none';
      preview.style.width = '60px';
      preview.style.height = '60px';
      preview.style.objectFit = 'cover';
      preview.style.border = '1px solid #ccc';
      container.appendChild(preview);
      container.appendChild(input);

      input.addEventListener('input', () => {
        const url = input.value.trim();
        if (!url) return preview.style.display = 'none';

        const imgTest = new Image();
        imgTest.onload = () => { preview.src = url; preview.style.display = 'inline-block'; };
        imgTest.onerror = () => preview.style.display = 'none';
        imgTest.src = url;
      });
    } else {
      container.appendChild(input); // для размеров
    }

    // Кнопка удаления
    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.className = 'remove-btn';
    removeBtn.innerHTML = '<i class="fas fa-times"></i>';
    removeBtn.onclick = () => { container.remove(); checkEmpty(list); };
    container.appendChild(removeBtn);

    list.appendChild(container);
  }

  // Проверка пустого списка
  function checkEmpty(list) {
    if (!list.querySelector('.option-row')) {
      const empty = document.createElement('span');
      empty.className = 'empty-text';
      empty.innerText = list.dataset.emptyText;
      list.appendChild(empty);
    }
  }
</script>
</body>
</html>


