<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="" xmlns:display="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Оформление заказа</title>
    <link rel="stylesheet" th:href="@{/checkout.css}">
    <link rel="stylesheet" th:href="@{/navbar.css}">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
<div th:insert="~{navbar :: navigation-panel}" class="navigation-panel"></div>
<!--    <div class="order-summary">-->
<!--        <h2>Сводка заказа</h2>-->
<!--        <ul class="order-items">-->
<!--            <li th:each="item : ${orderItems}">-->
<!--                <span th:text="${item.product.name}"></span>-->
<!--                <span th:text="${item.quantity} + ' шт.'"></span>-->
<!--                <span th:text="${item.product.price * item.quantity} + ' ₸'"></span>-->
<!--            </li>-->
<!--        </ul>-->
<!--        <div class="total-price">-->
<!--            <span>Итого:</span>-->
<!--            <span th:text="${totalPrice} + ' ₸'"></span>-->
<!--        </div>-->
<!--    </div>-->
<form th:action="@{/checkout}" method="post" class="checkout-container">
    <div class="left-part">
        <h2>Оформление заказа</h2>
        <div class="input-zone">
            <div class="checkout-box">
                <div class="input-block">
                    <label class="option">Контактные данные</label>
                    <div class="inputs" id="inputs1">
                        <input type="email" id="email" name="email" placeholder="Email*" required>
                        <input type="tel" id="phone" name="phone" placeholder="Телефон*" maxlength="20" required>
                        <input type="text" id="fullName" name="fullName" placeholder="ФИО*" class="name" maxlength="100" required>
                    </div>
                </div>
                <div class="input-block">
                    <label class="option">Информация для доставки</label>
                    <div class="inputs" id="inputs2">
                        <input type="text" id="country" name="country" placeholder="Страна*" maxlength="30" required>
                        <input type="text" id="city" name="city" placeholder="Город*" maxlength="34" required>
                        <input type="text" id="address" name="address" placeholder="Адрес*" class="address" required>
                        <input type="text" id="postalCode" name="postalCode" placeholder="Индекс*" maxlength="20" required>
                    </div>
                </div>
                <div class="checkbox-line">
                    <div class="input-block">
                        <label class="option">Доставка</label>
                        <label class="checkbox-option">
                            <input type="checkbox" class="checkbox-input delivery-option" id="option1">
                            <span class="checkbox-icon"></span>
                            <div class="checkbox-details">
                                <span class="checkbox-text">Стандарт</span>
                                <span class="checkbox-text">5-7 дней</span>
                                <span class="checkbox-text">Бесплатно</span>
                            </div>
                        </label>
                        <!--                            <label class="checkbox-option">-->
                        <!--                                <input type="checkbox" class="checkbox-input delivery-option" id="option2">-->
                        <!--                                <span class="checkbox-icon"></span>-->
                        <!--                                <div class="checkbox-details">-->
                        <!--                                    <span class="checkbox-text">Стандарт+</span>-->
                        <!--                                    <span class="checkbox-text">3-5 дней</span>-->
                        <!--                                    <span class="checkbox-text">3500тг</span>-->
                        <!--                                </div>-->
                        <!--                            </label>-->
                        <label class="checkbox-option">
                            <input type="checkbox" class="checkbox-input" id="option5">
                            <span class="checkbox-icon private-policy"></span>
                            <div class="private-policy">
                                <span class="private-policy-text">Я соглашаюсь с<a> Политикой конфиденциальности.</a></span>
                            </div>
                        </label>
                    </div>

                    <div class="input-block">
                        <label class="option">Способы оплаты</label>
                        <label class="checkbox-option">
                            <input type="checkbox" class="checkbox-input payment-option" id="option3">
                            <span class="checkbox-icon"></span>
                            <div class="checkbox-details">
                                <span class="checkbox-text">Банковские карты</span>
                            </div>
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" class="checkbox-input payment-option" id="option4">
                            <span class="checkbox-icon"></span>
                            <div class="checkbox-details">
                                <span class="checkbox-text">Другие</span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="right-part">
        <div class="card-container">
            <div class="card-div">
                <div class="card">
                    <div class="card-top">
                        <div class="visa">
                            <svg width="48px" height="48px" viewBox="0 -86.5 256 256" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="1.536"></g><g id="SVGRepo_iconCarrier"> <defs> <linearGradient x1="45.9741966%" y1="-2.00617467%" x2="54.8768726%" y2="100%" id="linearGradient-1"> <stop stop-color="#222357" offset="0%"> </stop> <stop stop-color="#254AA5" offset="100%"> </stop> </linearGradient> </defs> <g> <path d="M132.397094,56.2397455 C132.251036,44.7242808 142.65954,38.2977599 150.500511,34.4772086 C158.556724,30.5567233 161.262627,28.0430004 161.231878,24.5376253 C161.17038,19.1719416 154.805357,16.804276 148.847757,16.7120293 C138.454628,16.5505975 132.412467,19.5178668 127.607952,21.7625368 L123.864273,4.24334875 C128.684163,2.02174043 137.609033,0.084559486 146.864453,-7.10542736e-15 C168.588553,-7.10542736e-15 182.802234,10.7236802 182.879107,27.3511501 C182.963666,48.4525854 153.69071,49.6210438 153.890577,59.05327 C153.959762,61.912918 156.688728,64.964747 162.669389,65.7411565 C165.628971,66.133205 173.800493,66.433007 183.0636,62.1665965 L186.699658,79.11693 C181.718335,80.931115 175.314876,82.6684285 167.343223,82.6684285 C146.895202,82.6684285 132.512402,71.798691 132.397094,56.2397455 M221.6381,81.2078555 C217.671491,81.2078555 214.327548,78.8940005 212.836226,75.342502 L181.802894,1.24533061 L203.511621,1.24533061 L207.831842,13.1835926 L234.360459,13.1835926 L236.866494,1.24533061 L256,1.24533061 L239.303345,81.2078555 L221.6381,81.2078555 M224.674554,59.6067505 L230.939643,29.5804456 L213.781755,29.5804456 L224.674554,59.6067505 M106.076031,81.2078555 L88.9642665,1.24533061 L109.650591,1.24533061 L126.754669,81.2078555 L106.076031,81.2078555 M75.473185,81.2078555 L53.941265,26.7822953 L45.2316377,73.059396 C44.2092367,78.2252115 40.1734431,81.2078555 35.6917903,81.2078555 L0.491982464,81.2078555 L0,78.886313 C7.22599245,77.318119 15.4359498,74.7890215 20.409585,72.083118 C23.4537265,70.4303645 24.322383,68.985166 25.3217224,65.0569935 L41.8185094,1.24533061 L63.68098,1.24533061 L97.1972855,81.2078555 L75.473185,81.2078555" fill="url(#linearGradient-1)" transform="translate(128.000000, 41.334214) scale(1, -1) translate(-128.000000, -41.334214) "> </path> </g> </g></svg>
                        </div>
                        <div class="nfc">
                            <svg width="48px" height="35px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M16.3 19.5002C17.4 17.2002 18 14.7002 18 12.0002C18 9.30024 17.4 6.70024 16.3 4.50024M12.7 17.8003C13.5 16.0003 14 14.0003 14 12.0003C14 10.0003 13.5 7.90034 12.7 6.10034M9.1001 16.1001C9.7001 14.8001 10.0001 13.4001 10.0001 12.0001C10.0001 10.6001 9.7001 9.10015 9.1001 7.90015M5.5 14.3003C5.8 13.6003 6 12.8003 6 12.0003C6 11.2003 5.8 10.3003 5.5 9.60034" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                        </div>
                    </div>

                    <div class="card-number">
                    <span class="card-number-text" id="card-number-display">
                        <span>X</span><span>X</span><span>X</span><span>X</span>
                        <span> </span>
                        <span>X</span><span>X</span><span>X</span><span>X</span>
                        <span> </span>
                        <span>X</span><span>X</span><span>X</span><span>X</span>
                        <span> </span>
                        <span>X</span><span>X</span><span>X</span><span>X</span>
                    </span>
                    </div>

                    <div class="card-down">
                        <span class="card-name" id="card-name-display">IVANOV IVAN</span>
                        <span class="card-date" id="card-date-display">MM/YY</span>
                    </div>
                </div>
                <div class="card-back">
                    <div class="black-stripe"></div>
                    <div class="cvv-block">
                        <span class="cvv-label">CVV</span>
                        <span class="cvv-value" id="cvv-display">XXX</span>
                    </div>
                    <div class="signature-block">
                        <span class="signature-label">Authorized Signature</span>
                        <div class="signature"></div>
                    </div>
                </div>
            </div>
            <div class="card-input-zone">
                <div class="card-number-input">
                    <label class="input-title">Номер карты</label>
                    <input
                            class="card-input"
                            id="card-number-input"
                            type="text"
                            oninput="this.value = this.value.replace(/\D/g, '').replace(/(.{4})/g, '$1 ').trim(); updateCardNumber(this.value)"
                            maxlength="19"
                            name="cardNumber"
                    />
                </div>
                <div class="cart-container-down">
                    <div class="card-name-input">
                        <label class="input-title">Имя владельца</label>
                        <input class="card-input" id="card-name-input" name="cardHolderName" type="text" maxlength="50" style="text-transform: uppercase" pattern="[A-Za-z ]*" oninput="this.value = this.value.replace(/[^A-Za-z ]/g, '').replace(/\s{2,}/g, ' '); updateCardName(this.value)">
                    </div>
                    <div class="card-date-input">
                        <label class="input-title">Срок действия</label>
                        <!-- Месяц (2 цифры) -->
                        <input class="card-month-input" id="month-input"  name="expiryMonth" type="text" maxlength="2" placeholder="MM" inputmode="numeric" oninput="validateMonth(this); updateMonth(this.value)">
                        <!-- Год (2 цифры) -->
                        <input class="card-year-input" id="year-input"  name="expiryYear" type="text" maxlength="2" placeholder="YY" inputmode="numeric" oninput="validateYear(this); updateYear(this.value)">

                        <!-- Сообщение о просроченной карте -->
                        <div id="error-message" class="error-message" role="alert">
                            Ваша карта просрочена!
                        </div>
                    </div>
                    <div class="cvv-input">
                        <label class="input-title">CVV</label>
                        <input class="card-input"
                               id="cvv-input"
                               name="cvv"
                               type="text"
                               maxlength="3"
                               pattern="\d*"
                               inputmode="numeric"
                               oninput="this.value = this.value.replace(/\D/g, ''); updateCvv()">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="payment-button">
        <button type="submit" class="pay-btn">Оплатить заказ</button>
    </div>
</form>
</body>
<script>
    // Функция для обеспечения выбора только одного чекбокса в группе
    function handleSingleChoice(group) {
        const checkboxes = document.querySelectorAll(group);
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                // Если текущий чекбокс выбран, сбрасываем остальные в той же группе
                if (checkbox.checked) {
                    checkboxes.forEach(otherCheckbox => {
                        if (otherCheckbox !== checkbox) {
                            otherCheckbox.checked = false;
                        }
                    });
                }
            });
        });
    }

    // Применяем функцию для двух групп: доставки и способа оплаты
    handleSingleChoice('.delivery-option');  // Для группы доставки
    handleSingleChoice('.payment-option');   // Для группы способов оплаты



    // Функция для валидации ввода чисел
    function validateInput(input, maxValue) {
        let value = input.value;

        // Разрешаем ввод только цифр
        input.value = value.replace(/\D/g, '');

        // Ограничиваем значение
        if (value > maxValue) {
            input.value = maxValue;
        }

        // Проверка срока действия карты
        checkCardExpiry();
    }

    // Функция для валидации месяца (максимум 12)
    function validateMonth(input) {
        validateInput(input, 12);
    }

    // Функция для валидации года (максимум 35)
    function validateYear(input) {
        validateInput(input, 35);
    }

    // Функция для проверки просроченности карты
    function checkCardExpiry() {
        let monthInput = document.getElementById("month-input");
        let yearInput = document.getElementById("year-input");
        let errorMessage = document.getElementById("error-message");

        // Получаем текущую дату
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth() + 1; // Месяцы начинаются с 0, поэтому добавляем 1
        let currentYear = currentDate.getFullYear() % 100; // Берём последние 2 цифры года

        // Получаем введённые месяц и год
        let enteredMonth = parseInt(monthInput.value);
        let enteredYear = parseInt(yearInput.value);

        // Если все данные введены и карта просрочена
        if (enteredMonth && enteredYear) {
            if (enteredYear < currentYear || (enteredYear === currentYear && enteredMonth < currentMonth)) {
                errorMessage.textContent = "Ваша карта просрочена! Пожалуйста, проверьте дату.";
                errorMessage.classList.add("show"); // Показать сообщение об ошибке с анимацией
            } else {
                errorMessage.classList.remove("show"); // Скрыть сообщение об ошибке, если карта не просрочена
            }
        } else {
            errorMessage.classList.remove("show"); // Скрыть сообщение, если не все данные введены
        }
    }

    // Динамическая замена данных на карте
    function updateCardNumber(value) {
        const display = document.getElementById("card-number-display");
        const cardInput = value.replace(/\D/g, ''); // Убираем все нецифровые символы
        const cardSpans = Array.from(display.querySelectorAll("span"));

        let formattedIndex = 0; // Индекс для цифр

        // Проходим по всем span'ам и обновляем только те, которые содержат цифры
        cardSpans.forEach((span, index) => {
            // Пропускаем пробелы
            if (span.textContent === " ") return;

            if (formattedIndex < cardInput.length) {
                // Если есть цифры для отображения, обновляем их
                const currentChar = cardInput[formattedIndex];
                if (span.textContent !== currentChar) {
                    span.textContent = currentChar;
                    span.classList.add("fade-in");
                    span.classList.remove("fade-out");
                }
                formattedIndex++; // Переходим к следующей цифре
            } else {
                // Если цифры закончились, заменяем на "X"
                if (span.textContent !== "X") {
                    span.textContent = "X";
                    span.classList.add("fade-in");
                    span.classList.remove("fade-out");
                }
            }
        });

        // Снимаем эффект fade-in через небольшой промежуток времени
        setTimeout(() => {
            const updatedSpans = display.querySelectorAll(".fade-in");
            updatedSpans.forEach((span) => {
                span.classList.remove("fade-in");
            });
        }, 0); // Убираем анимацию после 100мс
    }

    // Обновление месяца
    function updateMonth(value) {
        const sanitizedValue = value.replace(/\D/g, '').slice(0, 2);
        const cardDateDisplay = document.getElementById("card-date-display");
        const [currentMonth, currentYear] = cardDateDisplay.textContent.split('/');

        // Обновляем только месяц
        cardDateDisplay.textContent = `${sanitizedValue || "MM"}/${currentYear || "YY"}`;
    }

    // Обновление года
    function updateYear(value) {
        const sanitizedValue = value.replace(/\D/g, '').slice(0, 2);
        const cardDateDisplay = document.getElementById("card-date-display");
        const [currentMonth, currentYear] = cardDateDisplay.textContent.split('/');

        // Обновляем только год
        cardDateDisplay.textContent = `${currentMonth || "MM"}/${sanitizedValue || "YY"}`;
    }

    function updateCardName(value) {
        const displayElement = document.getElementById("card-name-display");
        displayElement.innerHTML = '';

        // Разбиваем имя на отдельные символы
        const name = value.toUpperCase() || 'IVANOV IVAN';
        for (let i = 0; i < name.length; i++) {
            const span = document.createElement("span");
            span.textContent = name[i];
            displayElement.appendChild(span);
            setTimeout(() => {
                span.classList.add('visible');
            }, i * 100); // Задержка для каждого символа
        }
    }

    function updateCvv() {
        const cvv = document.getElementById("cvv-input").value;
        const cvvDisplay = document.getElementById("cvv-display");

        // Display only the first 3 characters (if available), or "XXX" if empty
        cvvDisplay.textContent = cvv.slice(0, 3).padEnd(3, 'X');
    }

    document.getElementById("cvv-input").addEventListener("focus", () => {
        document.querySelector(".card-div").classList.add("flipped");
    });

    document.getElementById("cvv-input").addEventListener("blur", () => {
        document.querySelector(".card-div").classList.remove("flipped");
    });

</script>
</html>


