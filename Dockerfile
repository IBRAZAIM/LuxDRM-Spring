# ====================================================================
# 1. –°–¢–†–û–ò–¢–ï–õ–¨–ù–´–ô –≠–¢–ê–ü (Builder Stage)
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–¥–µ–∂–Ω—ã–π –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ JDK 21 –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
FROM eclipse-temurin:21-jdk-jammy AS builder

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º pom.xml –∏ –ø–∞–ø–∫—É src —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º.
COPY pom.xml .
COPY src /app/src

# üö® –ö–û–ú–ê–ù–î–ê –°–ë–û–†–ö–ò:
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–∞–Ω–¥—É 'mvn' –Ω–∞–ø—Ä—è–º—É—é.
# -DskipTests: –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã.
# -Dmaven.deploy.skip=true: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ñ–ª–∞–≥ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ —Ñ–∞–∑—ã deploy (—É—Å—Ç—Ä–∞–Ω—è–µ—Ç –æ—à–∏–±–∫—É 'Deployment failed').
RUN mvn clean package -DskipTests -Dmaven.deploy.skip=true

# ====================================================================

# 2. –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–´–ô –≠–¢–ê–ü (Production Stage)
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π JRE 21 –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞).
FROM eclipse-temurin:21-jre-jammy

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤—ã–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π JAR-—Ñ–∞–π–ª –∏–∑ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–≥–æ —ç—Ç–∞–ø–∞.
# üö® –í–ê–ñ–ù–û: 'Catalog' ‚Äî —ç—Ç–æ –≤–∞—à Artifact ID. –ï—Å–ª–∏ –æ–Ω –¥—Ä—É–≥–æ–π, –∑–∞–º–µ–Ω–∏—Ç–µ –µ–≥–æ.
# –ó–≤–µ–∑–¥–æ—á–∫–∞ (*) –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞.
COPY --from=builder /app/target/Catalog-*.jar app.jar

# –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–∞—à–µ Spring-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
EXPOSE 8080

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
ENTRYPOINT ["java", "-jar", "app.jar"]