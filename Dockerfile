# ====================================================================
# 1. –°–¢–†–û–ò–¢–ï–õ–¨–ù–´–ô –≠–¢–ê–ü (Builder Stage)
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞–¥–µ–∂–Ω—ã–π JDK 21 –¥–ª—è —Å–±–æ—Ä–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
FROM eclipse-temurin:21-jdk-jammy AS builder

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã Maven Wrapper –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
# –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ ./mvnw
COPY .mvn .mvn
COPY mvnw .
COPY pom.xml .

# –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –ø–æ—Å–ª–µ pom.xml, —á—Ç–æ–±—ã Maven –º–æ–≥ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
COPY src /app/src

# üö® –ö–û–ú–ê–ù–î–ê –°–ë–û–†–ö–ò: –ò—Å–ø–æ–ª—å–∑—É–µ–º 'package', —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–∫–∏ 'deploy'
# -DskipTests –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏
RUN chmod +x mvnw && ./mvnw clean package -DskipTests -Dmaven.deploy.skip=true

# ====================================================================

# 2. –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–´–ô –≠–¢–ê–ü (Production Stage)
# –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é JRE 21 –¥–ª—è –∑–∞–ø—É—Å–∫–∞ (–º–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä)
FROM eclipse-temurin:21-jre-jammy

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
WORKDIR /app

# –ö–æ–ø–∏—Ä—É–µ–º –≥–æ—Ç–æ–≤—ã–π JAR-—Ñ–∞–π–ª –∏–∑ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ–≥–æ —ç—Ç–∞–ø–∞
# üö® –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ 'Catalog' –Ω–∞ –≤–∞—à —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π Artifact ID, –µ—Å–ª–∏ –æ–Ω –¥—Ä—É–≥–æ–π
COPY --from=builder /app/target/Catalog-*.jar app.jar

# –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Spring Boot (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8080)
EXPOSE 8080

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
ENTRYPOINT ["java", "-jar", "app.jar"]